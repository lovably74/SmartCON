# [SmartCON] 소프트웨어 시큐어 코딩(Secure Coding) 가이드

> **개요:** 본 문서는 행정안전부 및 KISA의 개발보안 가이드를 기반으로, '스마트콘' 서비스(Java Backend, Android App) 개발 시 준수해야 할 보안 약점 제거 및 코딩 규칙을 정의합니다.

---

## 1. 입력 데이터 검증 및 표현 (Input Validation)
*가장 빈번하게 발생하는 취약점으로, 외부 입력값을 신뢰하지 않고 검증해야 한다.*

### 1.1 SQL 삽입 (SQL Injection)
* **설명:** 외부 입력값이 DB 쿼리문의 구조를 변경하여 정보 유출 등을 유발하는 취약점.
* **대책:** 동적 쿼리 대신 **PreparedStatement**를 사용하고 파라미터 바인딩(`?`)을 적용한다.
    ```java
    // [안전한 코드]
    String query = "SELECT * FROM users WHERE id = ?";
    PreparedStatement pstmt = conn.prepareStatement(query);
    pstmt.setString(1, inputId);
    ResultSet rs = pstmt.executeQuery();
    ```

### 1.2 크로스사이트 스크립트 (XSS)
* **설명:** 악성 스크립트를 삽입하여 사용자 브라우저에서 실행시키는 취약점.
* **대책:** 입력값을 HTML 인코딩(치환) 처리하거나, 잘 알려진 XSS 방지 라이브러리(Lucy-XSS Filter 등)를 사용한다.
    * `<` &rarr; `&lt;`
    * `>` &rarr; `&gt;`

### 1.3 경로 조작 및 자원 삽입
* **설명:** 외부 입력값으로 파일 경로를 조작하여 시스템 중요 파일에 접근하는 취약점.
* **대책:** 경로 순회 문자(`..`, `/`, `\`)를 필터링하고, 허용된 경로 목록(White-list) 내에서만 파일에 접근한다.

---

## 2. 보안 기능 (Security Features)

### 2.1 적절한 인증 및 인가
* **설명:** 중요 기능(계약 서명, 개인정보 조회 등) 접근 시 서버 측에서 세션 및 권한을 반드시 확인해야 한다.
* **대책:** 프론트엔드(UI) 숨김 처리에 의존하지 말고, **백엔드 API에서 반드시 권한(Role) 체크**를 수행한다.

### 2.2 중요 정보 암호화
* **비밀번호:** 복호화가 불가능한 일방향 해시 함수(SHA-256 이상)를 사용하며, **Salt**를 적용한다.
* **개인정보(주민번호 등):** AES-256 등 안전한 양방향 알고리즘을 사용하며 암호화 키는 소스코드와 분리하여 안전하게 관리한다.

### 2.3 하드코딩된 중요 정보 제거
* **대책:** DB 비밀번호, 암호화 키, API Key 등을 소스코드 내부에 하드코딩하지 않는다. 설정 파일이나 환경 변수에서 읽어오도록 구현한다.

---

## 3. 에러 처리 (Error Handling)
* **설명:** 에러 발생 시 시스템 내부 정보(스택 트레이스, DB 구조 등)가 노출되지 않도록 해야 한다.
* **대책:** 예외 처리(`try-catch`) 구문 내부에서 `e.printStackTrace()`를 사용하여 에러 로그를 콘솔이나 사용자 화면에 직접 출력하지 않는다. 로깅 프레임워크(Log4j, Slf4j)를 사용하여 파일로 기록한다.

---

## 4. 코드 품질 및 캡슐화 (Code Quality)

### 4.1 자원 반환 (Resource Release)
* **설명:** DB 연결, 파일 I/O 등 시스템 자원은 사용 후 반드시 반환해야 한다.
* **대책:** `finally` 블록이나 Java의 `try-with-resources` 구문을 사용하여 `close()` 메소드가 확실히 호출되도록 한다.

### 4.2 캡슐화 위배
* **대책:** `public` 필드 사용을 지양하고, `private`으로 선언한 뒤 Getter/Setter를 통해 접근한다. 배열을 리턴할 때는 복사본(Clone)을 리턴하여 내부 데이터 변경을 방지한다.

---

## 5. [Android] 모바일 앱 시큐어 코딩
*스마트콘 모바일 앱(Android) 개발 시 추가 준수 사항*

### 5.1 중요 정보 노출 방지
* **Logcat:** 개발 과정에서 사용한 `Log.d()`, `Log.v()` 등은 릴리즈 빌드 시 제거하거나 ProGuard를 통해 난독화/제거 처리한다. 민감 정보가 로그에 남지 않도록 한다.
* **SD카드 저장:** 외부 저장소(SD카드)는 모든 앱이 읽을 수 있으므로 중요 정보를 저장하지 않는다. 필요시 내부 저장소(`Internal Storage`)를 사용한다.

### 5.2 컴포넌트 권한 설정 (AndroidManifest.xml)
* **Exported 속성:** 다른 앱에서 호출할 필요가 없는 Activity, Service, Receiver는 `android:exported="false"`로 설정하여 외부 접근을 차단한다.
    ```xml
    <activity android:name=".PrivateActivity"
        android:exported="false" />
    ```

### 5.3 앱 권한(Permission) 최소화
* **대책:** 불필요한 시스템 권한을 요청하지 않으며, 안면인식(카메라), 위치 정보 등 민감 권한은 런타임에 사용자 동의를 명확히 받는다.

---

## 6. 개발 보안 체크리스트 (Summary)

- [ ] (서버) SQL Injection 방지를 위해 PreparedStatement를 사용하는가?
- [ ] (서버) 비밀번호는 Salt를 포함하여 일방향 해시(SHA-256 이상) 처리하는가?
- [ ] (서버) 파일 업로드 시 확장자와 파일 타입을 검증하는가?
- [ ] (공통) 소스코드 내 하드코딩된 비밀번호/키가 없는가?
- [ ] (모바일) `android:exported` 속성이 올바르게 설정되었는가?
- [ ] (모바일) 릴리즈 버전에 디버그 로그가 남아있지 않은가?