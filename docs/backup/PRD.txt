

# [AI-Native PRD] SmartCON Lite Development Context

> **Prompt for Cursor/Antigravity:**
> "너는 지금부터 20년 경력의 시니어 풀스택 개발자다. 아래의 PRD 문서를 완벽하게 숙지하고, 이 문서에 정의된 기술 스택, 폴더 구조, UI 가이드라인, 비즈니스 로직을 엄격하게 준수하여 코드를 작성해야 한다. 프로젝트의 목표는 '스마트콘 라이트'라는 SaaS 기반 건설 인력관리 플랫폼을 구축하는 것이다."

---

## 1. Tech Stack & Environment (엄격 준수)

AI 에이전트가 코드를 생성할 때 사용할 기술 스택을 고정합니다.

### 1.1 Backend

* **Language:** Java 17 (LTS)
* **Framework:** Spring Boot 3.3.x
* **Build Tool:** Gradle (Groovy)
* **Database:** MariaDB 10.11 (JPA/Hibernate)
* **ORM:** Spring Data JPA + QueryDSL (복잡한 조회용)
* **Security:** Spring Security 6.x + JWT + OAuth2 Client
* **Utils:** Lombok, MapStruct (DTO 매핑), iText (PDF 생성)

### 1.2 Frontend (Web & Mobile WebApp)

* **Framework:** React 18 + TypeScript + Vite
* **State Mgmt:** TanStack Query (React Query) + Zustand (Global Client State)
* **Styling:** **Tailwind CSS** (v3.4) + **Shadcn/UI** (Component Library)
* **Mobile Bridge:** Capacitor (네이티브 기능 패키징 용도)
* **Routing:** React Router v6

### 1.3 Architecture Pattern

* **Backend:** Domain-Driven Design (DDD) Layers (`Controller` -> `Service` -> `Repository` -> `Entity`)
* **Frontend:** Feature-based Structure (`src/features/auth`, `src/features/attendance`...)

---

## 2. Database Schema (Entity Definition)

AI가 가장 먼저 이해해야 할 데이터 구조입니다. 멀티테넌시(`tenant_id`)가 핵심입니다.

```java
// Common Concept: All entities extend BaseEntity (createdAt, updatedAt)
// Logic: 모든 쿼리에는 tenant_id 필터가 자동 적용되어야 함 (Hibernate @Filter 사용)

/* 1. SaaS & Tenants */
Entity Company {
  Long id (PK);
  String businessNo (Unique); // 사업자번호
  String name;
  Enum planType; // BASIC, PRO, ENTERPRISE
  LocalDate nextBillingDate;
  String billingKey; // PG사 빌링키 (Encrypted)
}

/* 2. User & Auth */
Entity User {
  Long id (PK);
  Long companyId; // Nullable (일용직은 소속 없음)
  String ci; // Connection Info (본인인증 고유키, Unique)
  String name;
  String phone;
  Enum role; // HEAD, SITE, TEAM, WORKER, SUPER_ADMIN
  String profileImage; // 안면인식용 사진 URL
  String socialProvider; // KAKAO, NAVER, APPLE
}

/* 3. Site & Device */
Entity Site {
  Long id (PK);
  Long companyId;
  String name;
  String address;
  String faceDeviceSerial; // 안면인식기 시리얼
}

/* 4. Mapping & Workflow */
Entity SiteUserMapping {
  Long id (PK);
  Long siteId;
  Long userId;
  Enum siteRole; // SITE_MANAGER, TEAM_LEADER, WORKER
  Enum status; // INVITED, ACTIVE, INACTIVE
  String tradeType; // 공종 (철근, 형틀 등)
}

/* 5. Attendance & Contract */
Entity AttendanceLog {
  Long id (PK);
  Long siteId;
  Long userId;
  LocalDate workDate;
  LocalDateTime checkIn;
  LocalDateTime checkOut;
  BigDecimal manDay; // 1.0 or 0.5
  Enum source; // FACENET, APP_GPS, MANUAL
}

Entity Contract {
  Long id (PK);
  Long siteId;
  Long userId;
  String pdfUrl;
  Enum signStatus; // PENDING, SIGNED
  LocalDateTime signedAt;
}

```

---

## 3. UI/UX & Design System Requirements

AI가 프론트엔드 코드를 짤 때 참고할 디자인 가이드입니다. **Shadcn/UI**와 **Tailwind** 클래스를 기준으로 설명합니다.

### 3.1 Layout Strategy (Responsive)

* **PC View (`md` 이상):**
* 좌측 고정 사이드바 (`w-64`), 상단 헤더 (`h-16`), 중앙 컨텐츠 영역 (`flex-1`).
* 데이터는 `Table` (Data Grid) 형태 위주.


* **Mobile View (`md` 미만):**
* 하단 탭 바 (`Bottom Navigation`, 높이 `h-16`).
* 데이터는 `Card` 리스트 형태.
* 헤더는 페이지 타이틀과 뒤로가기 버튼만 존재.



### 3.2 Color Palette

* **Primary:** `#2563EB` (Tailwind `blue-600`) - 주요 버튼, 활성 상태.
* **Destructive:** `#EF4444` (Tailwind `red-500`) - 삭제, 미서명, 경고.
* **Background:** `#F3F4F6` (Tailwind `gray-100`) - 앱 배경색.
* **Surface:** `#FFFFFF` (White) - 카드 및 컨테이너 배경.

---

## 4. Feature Implementation Guide (Step-by-Step)

AI 에이전트에게 "기능 1번을 구현해줘"라고 명령할 때 사용할 명세입니다.

### Feature 1: 통합 로그인 및 온보딩 (Auth)

* **Context:** PC와 모바일 모두 접근. 소셜 로그인과 ID/PW 로그인이 공존.
* **UI Specs:**
* **Login Page:** 화면 중앙에 `Card` 배치. 상단 로고.
* Input: `ID`, `Password` (본사 관리자용).
* Divider: "또는 SNS로 시작하기".
* Buttons: `Kakao`(노란색), `Naver`(초록색), `Apple`(검은색) 아이콘 버튼 가로 배치.




* **Business Logic (Backend):**
* `POST /api/auth/social`: 소셜 토큰 수신 -> CI값 추출 -> DB 조회.
* **Merge Logic:** 기존 `ci`가 있으면 해당 User 반환. 없으면 신규 생성.
* **JWT:** Access Token(30분), Refresh Token(7일) 발급.



### Feature 2: 딥링크 초대 및 자동 소속 (Deep Link)

* **Context:** SMS 링크를 타고 들어온 사용자를 처리.
* **UI Specs (Mobile Web):**
* **Landing Page:** "김철수 소장님이 귀하를 초대했습니다." 문구.
* Buttons: `[앱으로 보기 (설치)]`, `[웹으로 계속하기]`.


* **Logic:**
* URL Parameter `token`을 `localStorage`에 저장.
* 회원가입/로그인 완료 시점에 `POST /api/invitations/accept { token }` 호출.
* 백엔드는 해당 토큰을 검증하고 `SiteUserMapping` 테이블에 `INSERT`.



### Feature 3: 현장 관리자 대시보드 (Site Admin)

* **Context:** 현장 관리자가 출근하자마자 보는 화면.
* **UI Specs (PC):**
* **Top Widgets:** 4개의 카드 가로 배치. (총 인원, 안면인식 출근, 미계약자, 공정률).
* **Main Content:** `Tab` 컴포넌트 사용 (출역현황 | 근로계약 | 작업일보).
* **Contract Tab:**
* 테이블 리스트: `Checkbox`(선택), `이름`, `공종`, `상태(미서명/완료)`.
* **Floating Action Button:** 미서명자 체크 시 하단에 "3명에게 일괄 서명 요청 보내기" 버튼 노출.





### Feature 4: 노무자 출역 조회 및 전자서명 (Worker)

* **Context:** 노무자가 퇴근 전 공수 확인 및 계약 서명.
* **UI Specs (Mobile):**
* **Calendar View:** `react-calendar` 라이브러리 커스텀. 날짜 셀 안에 `1.0`(파란 뱃지), `0.5`(노란 뱃지) 표시.
* **Contract Modal:**
* 계약서 PDF를 `iframe` 또는 `react-pdf`로 표시.
* 하단에 `Canvas` 영역 (서명 패드).
* Button: `[서명 제출하기]`.





---
