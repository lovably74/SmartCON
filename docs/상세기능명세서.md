# SmartCON Lite 상세기능명세서 (통합본)

**문서 버전:** 4.0  
**작성일:** 2025년 12월 31일  
**최종 수정일:** 2025년 12월 31일  
**작성자:** Kiro AI Assistant  
**통합 기반 문서:** 상세기능명세서 v3.0, PRD v2.8, Functional-Specification v2.1

---

## 1. 문서 개요

본 문서는 SmartCON Lite SaaS 플랫폼의 상세 기능명세를 정의합니다. 
5단계 사용자 역할(슈퍼관리자, 본사관리자, 현장관리자, 팀장, 노무자)별 기능과 
멀티테넌트 아키텍처 기반의 시스템 요구사항을 포함합니다.

### 1.1 문서 목적
- 개발팀을 위한 상세 구현 가이드 제공
- 사용자 스토리 및 수용 기준 정의
- API 설계 및 데이터 모델 명세
- 테스트 시나리오 및 검증 기준 제시

### 1.2 적용 범위
- 웹 애플리케이션 (React + TypeScript)
- 모바일 웹앱 (Capacitor 기반 하이브리드)
- 백엔드 API (Spring Boot + MariaDB)
- 외부 연동 시스템 (FaceNet, 기상청, PG사, 홈택스)

### 1.3 핵심 목표
- **SaaS Platform**: 멀티테넌시(Multi-tenancy) 및 구독 결제/관리 시스템 구축
- **Role-Based Optimization**: 본사/현장/팀장/노무자 + **시스템 관리자(Super Admin)** 5단계 역할 지원
- **Automation**: 안면인식(FaceNet) 출역 자동화, 전자계약 원스톱 처리, 세금계산서 발행(API)
- **Mobile First**: 현장 중심의 하이브리드 앱 (React + Capacitor)

---

## 2. 시스템 아키텍처 및 기술 스택

### 2.1 멀티테넌트 아키텍처
- **격리 방식**: Shared Database, Shared Schema with tenant_id
- **테넌트 식별**: JWT 토큰 내 tenant_id 포함
- **데이터 격리**: 모든 비즈니스 테이블에 tenant_id 컬럼 강제
- **파일 격리**: S3 경로에 tenant_id 포함 (s3://bucket/{tenant_id}/...)

### 2.2 기술 스택 상세
#### Frontend
- **Framework**: React 18.2+ with TypeScript 5.0+
- **Build Tool**: Vite 5.0+ (HMR, Tree-shaking)
- **UI Library**: Shadcn/UI + Tailwind CSS 3.4+
- **State Management**: 
  - Zustand 4.4+ (클라이언트 상태)
  - TanStack Query 5.0+ (서버 상태, 캐싱)
- **Routing**: Wouter 3.0+ (경량 라우터)
- **Mobile**: Capacitor 6.0+ (카메라, GPS, 푸시알림)

#### Backend
- **Language**: Java 17 LTS
- **Framework**: Spring Boot 3.3.x
- **Database**: MariaDB 10.11 with JPA/Hibernate 6.x
- **Security**: Spring Security 6.x + JWT + OAuth2
- **Batch**: Spring Batch 5.x (안면인식 동기화, 정산)
- **Build**: Maven 3.8+

#### Infrastructure
- **Container**: Docker + Docker Compose
- **Storage**: AWS S3 (파일, 이미지)
- **Cache**: Redis 7.x (세션, 임시데이터)
- **CI/CD**: GitHub Actions (권장)

---

## 3. 사용자 역할 및 권한 매트릭스

### 3.1 역할 정의
| 역할 코드 | 역할명 | 주요 책임 | 접근 플랫폼 |
|-----------|--------|-----------|-------------|
| ROLE_SUPER | 슈퍼관리자 | SaaS 플랫폼 운영, 테넌트 관리, 결제/정산 | Web Only |
| ROLE_HQ | 본사관리자 | 테넌트 관리, 현장 개설, 전사 통계 | Web Only |
| ROLE_SITE | 현장관리자 | 현장 운영, 작업 지시, 출역 마감 | Web + Mobile |
| ROLE_TEAM | 팀장 | 팀원 관리, 작업 수락, 일보 제출 | Mobile Only |
| ROLE_WORKER | 노무자 | 출역 조회, 전자계약 서명 | Mobile Only |

### 3.2 권한 매트릭스

| 기능 영역 | SUPER | HQ | SITE | TEAM | WORKER |
|-----------|-------|----|----- |------|--------|
| **테넌트 관리** | ✓ | - | - | - | - |
| **구독/결제 관리** | ✓ | ✓ | - | - | - |
| **현장 개설/관리** | ✓ | ✓ | - | - | - |
| **사용자 초대/승인** | ✓ | ✓ | ✓ | - | - |
| **작업 지시/배정** | - | - | ✓ | - | - |
| **작업 수락/거부** | - | - | - | ✓ | - |
| **출역 기록 조회** | ✓ | ✓ | ✓ | ✓ | ✓ |
| **출역 마감/승인** | - | - | ✓ | - | - |
| **공사일보 작성** | - | - | ✓ | ✓ | - |
| **전자계약 서명** | - | - | - | - | ✓ |
| **정산/급여 조회** | ✓ | ✓ | ✓ | ✓ | ✓ |
| **안면인식 등록** | - | - | - | - | ✓ |
| **시스템 설정** | ✓ | ✓ | - | - | - |

---

## 4. 인증 및 온보딩 프로세스

### 4.1 인트로 페이지 (/) 
#### 4.1.1 기능 요구사항
- **목적**: 서비스 소개 및 로그인 진입점 제공
- **주요 메시지**: 
  - 메인: "안전관리, 이제는 스마트하게!"
  - 서브: "본사와 현장관리까지 한 번에 업무 끝! 스마트콘 [SmartCON]"
- **구성 요소**:
  - 상단 네비게이션 메뉴 (PC)
  - 서비스 소개 섹션
  - 핵심 기능 소개
  - 요금제 안내
  - 문의/데모 신청 폼
  - 로그인 버튼 (CTA)

#### 4.1.2 상단 메뉴 (PC 전용)
- 비대면바우처 (배지 표시)
- 스마트콘 소개
- 스마트콘 핵심기능  
- 서비스요금
- 문의하기
- 로그인

#### 4.1.3 문의/데모 신청 폼
**필수 입력 필드:**
- 회사명 (required)
- 담당자 성함 (required)
- 직책 (optional)
- 연락처 (required, 휴대폰 형식 검증)
- 이메일 (required, 이메일 형식 검증)
- 문의내용 (required, textarea)

**동의 항목:**
- 개인정보 수집 및 이용 동의 (required)
- 마케팅 수집 및 활용 동의 (optional)

**보안 검증:**
- 로봇 방지 질문 (간단한 수학 문제)

**반응형 레이아웃:**
- Desktop: 2컬럼 (입력 필드 / 문의내용 분리)
- Mobile: 1컬럼 (세로 스택)

### 4.2 로그인 방식 선택 (/login)
#### 4.2.1 기능 요구사항
- **본사 관리자 로그인**: 사업자번호 + 비밀번호 방식
- **소셜 로그인**: Kakao, Naver OAuth2 연동
- **UI 구성**: 
  - 로그인 방식 선택 카드 (2개)
  - 각 방식별 설명 텍스트
  - 뒤로가기 버튼 (인트로 페이지로)

### 4.3 본사 관리자 로그인 (/login/hq)
#### 4.3.1 기능 요구사항
- **인증 방식**: 사업자번호(ID) + 비밀번호
- **입력 검증**:
  - 사업자번호: 10자리 숫자, 하이픈 자동 삽입
  - 비밀번호: 8자 이상, 영문+숫자+특수문자 조합
- **보안 기능**:
  - 5회 실패 시 계정 잠금 (30분)
  - 로그인 시도 로그 기록
  - HTTPS 강제

### 4.4 소셜 로그인 (/login/social)
#### 4.4.1 기능 요구사항
- **지원 플랫폼**: Kakao, Naver OAuth2
- **인증 플로우**:
  1. 소셜 플랫폼 선택
  2. OAuth2 인증 페이지 리다이렉트
  3. 인증 성공 시 콜백 처리
  4. 신규 사용자: 추가 정보 입력 (이름, 연락처)
  5. 기존 사용자: 역할/현장 선택 후 대시보드 이동

### 4.5 역할/현장 선택
#### 4.5.1 기능 요구사항
- **다중 역할 지원**: 한 사용자가 여러 현장에서 다른 역할 수행 가능
- **현장 목록**: 사용자가 속한 현장 목록 표시
- **역할 표시**: 각 현장에서의 역할 배지 표시
- **최근 접속**: 마지막 선택한 현장/역할 우선 표시

---

## 5. 슈퍼 관리자 (ROLE_SUPER) 기능 명세

### 5.1 테넌트 관리 (ADM-01)
#### 5.1.1 기능 개요
SaaS 플랫폼에 가입한 모든 고객사(테넌트)의 생명주기를 관리합니다.

#### 5.1.2 상세 기능
**[ADM-01-01] 테넌트 목록 조회**
- **경로**: `/super/tenants`
- **기능**: 
  - 전체 테넌트 목록 페이징 조회
  - 검색 필터: 회사명, 사업자번호, 상태, 가입일
  - 정렬: 가입일, 매출액, 사용자 수
- **표시 정보**:
  - 회사명, 사업자번호
  - 가입일, 구독 상태
  - 월 매출액, 활성 사용자 수
  - 현장 수, 마지막 접속일

**[ADM-01-02] 테넌트 상세 정보**
- **경로**: `/super/tenants/{tenantId}`
- **기능**:
  - 테넌트 기본 정보 조회/수정
  - 구독 이력 및 결제 내역
  - 사용량 통계 (현장 수, 사용자 수, 저장 용량)
  - 접속 로그 및 활동 내역

**[ADM-01-03] 테넌트 상태 관리**
- **상태 종류**: 
  - ACTIVE (정상 운영)
  - SUSPENDED (일시 중지)
  - TERMINATED (해지)
  - TRIAL (체험판)
- **상태 변경 사유**: 결제 실패, 약관 위반, 사용자 요청 등
- **자동 처리**: 결제 실패 시 7일 후 자동 중지

### 5.2 결제 및 정산 관리 (ADM-02)
#### 5.2.1 기능 개요
구독 결제 모니터링, 실패 건 처리, 매출 분석을 수행합니다.

#### 5.2.2 상세 기능
**[ADM-02-01] 결제 대시보드**
- **경로**: `/super/billing/dashboard`
- **KPI 지표**:
  - 월간 매출액 (MRR - Monthly Recurring Revenue)
  - 신규 가입 고객 수 (New Customers)
  - 해지 고객 수 (Churned Customers)
  - 결제 성공률 (Payment Success Rate)
- **차트**:
  - 월별 매출 추이
  - 요금제별 가입 현황
  - 결제 실패 원인 분석

**[ADM-02-02] 결제 실패 관리**
- **경로**: `/super/billing/failed-payments`
- **기능**:
  - 결제 실패 건 목록 조회
  - 실패 사유별 분류 (카드 한도, 정지, 만료 등)
  - 재결제 시도 (Retry) 수동/자동 실행
  - 고객 알림 발송 (SMS, 이메일)

**[ADM-02-03] 세금계산서 발행**
- **경로**: `/super/billing/tax-invoices`
- **자동 발행**: 매월 1일 전월 사용분 일괄 발행
- **홈택스 연동**: 국세청 전자세금계산서 시스템 연동
- **발행 상태**: 대기, 발행완료, 전송완료, 실패
- **재발행**: 실패 건에 대한 수동 재발행 기능

### 5.3 시스템 모니터링 (ADM-03)
#### 5.3.1 기능 개요
플랫폼 전체의 성능, 사용량, 오류를 모니터링합니다.

#### 5.3.2 상세 기능
**[ADM-03-01] 시스템 대시보드**
- **서버 상태**: CPU, 메모리, 디스크 사용률
- **데이터베이스**: 연결 수, 쿼리 성능, 슬로우 쿼리
- **외부 API**: FaceNet, 기상청, PG사 연동 상태
- **사용량 통계**: 일일 활성 사용자, API 호출 수

**[ADM-03-02] 오류 모니터링**
- **에러 로그**: 시스템 오류 실시간 수집
- **알림 설정**: 임계치 초과 시 Slack/이메일 알림
- **성능 지표**: 응답 시간, 처리량, 오류율

---

## 6. 본사 관리자 (ROLE_HQ) 기능 명세

### 6.1 회사 정보 관리 (HQ-01)
#### 6.1.1 기능 개요
테넌트(회사)의 기본 정보, 브랜딩, 표준 설정을 관리합니다.

#### 6.1.2 상세 기능
**[HQ-01-01] 회사 기본 정보**
- **경로**: `/hq/company/profile`
- **관리 항목**:
  - 회사명, 사업자등록번호
  - 대표자명, 업종, 업태
  - 주소 (본사, 사업장)
  - 연락처 (대표전화, 팩스)
- **첨부 파일**:
  - 회사 로고 (PNG, JPG, 최대 2MB)
  - 직인 이미지 (계약서 날인용)
  - 사업자등록증 사본

**[HQ-01-02] 구독 신청 및 관리**
- **경로**: `/hq/subscription`
- **신규 구독 신청**:
  - 요금제 선택 (Basic, Standard, Premium, Enterprise)
  - 예상 사용량 입력 (현장 수, 사용자 수)
  - 결제 수단 등록 (신용카드, 계좌이체)
  - 약관 동의 및 전자서명
- **현재 구독 정보**:
  - 요금제명, 월 이용료
  - 다음 결제일, 결제 수단
  - 사용량 (현장 수, 사용자 수)
  - 사용률 (제한 대비 현재 사용량)

### 6.2 현장 관리 (HQ-02)
#### 6.2.1 기능 개요
회사 소속 모든 현장의 개설, 설정, 모니터링을 수행합니다.

#### 6.2.2 상세 기능
**[HQ-02-01] 현장 목록 및 현황**
- **경로**: `/hq/sites`
- **목록 정보**:
  - 현장명, 위치, 공사 기간
  - 현장 관리자, 팀 수, 노무자 수
  - 진행 상태, 마지막 활동일
- **필터링**: 상태별, 지역별, 관리자별
- **정렬**: 생성일, 활동일, 규모순

**[HQ-02-02] 신규 현장 개설**
- **경로**: `/hq/sites/new`
- **필수 정보**:
  - 현장명, 공사명
  - 주소 (도로명 주소 API 연동)
  - 공사 기간 (시작일, 종료일)
  - 현장 관리자 지정
- **선택 정보**:
  - 현장 설명, 특이사항
  - 안면인식기 시리얼 번호
  - 표준 공종/직종 적용 여부

### 6.3 표준 관리 (HQ-03)
#### 6.3.1 기능 개요
전사 표준 공종, 직종, 노무 단가를 설정하고 관리합니다.

#### 6.3.2 상세 기능
**[HQ-03-01] 공종 관리**
- **경로**: `/hq/standards/work-types`
- **표준 공종**: 토공, 콘크리트공, 철근공, 조적공 등
- **공종별 설정**:
  - 공종명, 코드
  - 기본 작업 시간 (8시간, 10시간 등)
  - 위험도 등급 (안전 관리 기준)
- **현장별 적용**: 표준 공종을 현장에 일괄 적용

**[HQ-03-02] 직종 및 단가 관리**
- **경로**: `/hq/standards/job-types`
- **직종 분류**: 기능공, 보통인부, 특별인부
- **단가 설정**:
  - 기본 일당 (8시간 기준)
  - 연장 근무 시급
  - 야간/휴일 할증률
- **지역별 차등**: 수도권, 지방 등 지역별 단가 차등 적용

### 6.4 전사 대시보드 (HQ-04)
#### 6.4.1 기능 개요
전체 현장의 핵심 지표를 실시간으로 모니터링합니다.

#### 6.4.2 상세 기능
**[HQ-04-01] 핵심 지표 (KPI)**
- **경로**: `/hq/dashboard`
- **실시간 지표**:
  - 전체 현장 수 (활성/완료)
  - 금일 출역 인원 (전체/현장별)
  - 미서명 계약서 수
  - 미제출 일보 수
- **월간 통계**:
  - 총 공수 (man-day)
  - 평균 출역률
  - 계약 체결률
  - 일보 제출률

---

## 7. 현장 관리자 (ROLE_SITE) 기능 명세

### 7.1 현장 운영 관리 (SITE-01)
#### 7.1.1 기능 개요
담당 현장의 일상적인 운영 업무를 관리합니다.

#### 7.1.2 상세 기능
**[SITE-01-01] 현장 대시보드**
- **경로**: `/site/dashboard`
- **금일 현황**:
  - 출역 인원 (출근/퇴근/현재 현장)
  - 작업 팀 현황 (배정/진행/완료)
  - 미처리 업무 (승인 대기, 일보 미제출)
- **주간 통계**:
  - 일별 출역 인원 차트
  - 공종별 투입 인원
  - 계약 체결 현황

### 7.2 팀 및 인력 관리 (SITE-02)
#### 7.2.1 기능 개요
현장 내 작업 팀과 노무자를 관리합니다.

#### 7.2.2 상세 기능
**[SITE-02-01] 팀 관리**
- **경로**: `/site/teams`
- **팀 목록**:
  - 팀명, 팀장, 팀원 수
  - 주요 공종, 현재 작업 상태
  - 최근 출역률, 계약 체결률
- **팀 등록**:
  - 팀장 초대 (SMS 링크 발송)
  - 팀 정보 입력 (팀명, 주요 공종)
  - 승인/반려 처리

### 7.3 작업 지시 및 배정 (SITE-03)
#### 7.3.1 기능 개요
팀별 작업을 계획하고 배정합니다.

#### 7.3.2 상세 기능
**[SITE-03-01] 작업 계획**
- **경로**: `/site/work-assignments`
- **작업 요청 생성**:
  - 작업일 (내일 기준)
  - 공종, 작업 위치
  - 필요 인원 수
  - 특이사항, 주의사항
- **팀 선택**: 해당 공종 가능 팀 목록에서 선택
- **요청 발송**: 선택된 팀장에게 Push 알림 발송

### 7.4 출역 관리 및 마감 (SITE-04)
#### 7.4.1 기능 개요
일일 출역 현황을 확인하고 공수를 확정합니다.

#### 7.4.2 상세 기능
**[SITE-04-01] 실시간 출역 현황**
- **경로**: `/site/attendance/today`
- **현재 현장 인원**:
  - 출근 완료 (안면인식 확인)
  - 현장 내 (GPS 기준)
  - 퇴근 완료
- **팀별 현황**: 팀별 출역 인원 및 비율
- **이상 상황**: 미출근, 조기퇴근, 인식 실패

### 7.5 공사일보 관리 (SITE-05)
#### 7.5.1 기능 개요
일일 작업 내용을 취합하여 공사일보를 작성합니다.

#### 7.5.2 상세 기능
**[SITE-05-01] 일보 취합**
- **경로**: `/site/daily-reports`
- **자동 수집 정보**:
  - 날씨, 기온 (기상청 API)
  - 출역 인원 (안면인식 데이터)
  - 투입 장비 (사전 등록 기준)
- **팀별 제출 내용**:
  - 작업 내용, 진행률
  - 작업 사진
  - 특이사항, 안전사고

---

## 8. 팀장 (ROLE_TEAM) 기능 명세

### 8.1 작업 요청 관리 (TEAM-01)
#### 8.1.1 기능 개요
현장 관리자로부터 받은 작업 요청을 검토하고 수락/거부를 결정합니다.

#### 8.1.2 상세 기능
**[TEAM-01-01] 작업 요청 알림**
- **Push 알림**: 새로운 작업 요청 시 즉시 알림
- **알림 내용**: 작업일, 공종, 위치, 필요 인원
- **긴급도 표시**: 일반/긴급 구분
- **응답 기한**: 요청 후 2시간 이내 응답 권장

### 8.2 팀원 관리 (TEAM-02)
#### 8.2.1 기능 개요
팀 소속 노무자들을 관리하고 작업에 배정합니다.

#### 8.2.2 상세 기능
**[TEAM-02-01] 팀원 목록 관리**
- **경로**: `/team/members`
- **팀원 정보**:
  - 이름, 연락처, 주요 공종
  - 계약 상태, 안면인식 등록 여부
  - 최근 출역일, 월간 공수
  - 기술 등급 (초급/중급/고급)

### 8.3 간편 일보 작성 (TEAM-03)
#### 8.3.1 기능 개요
일일 작업 내용을 간단하게 기록하여 현장 관리자에게 보고합니다.

#### 8.3.2 상세 기능
**[TEAM-03-01] 작업 사진 촬영**
- **카메라 연동**: Capacitor Camera API 사용
- **사진 요구사항**:
  - 작업 전/후 비교 사진
  - 안전 장비 착용 확인
  - 작업 진행 상황
- **자동 정보**: GPS 좌표, 촬영 시간 자동 기록

---

## 9. 노무자 (ROLE_WORKER) 기능 명세

### 9.1 출역 관리 (WORK-01)
#### 9.1.1 기능 개요
개인의 출역 현황을 조회하고 관리합니다.

#### 9.1.2 상세 기능
**[WORK-01-01] 금일 출역 현황**
- **경로**: `/worker/attendance/today`
- **출근 상태**: 미출근/출근완료/퇴근완료
- **출근 시간**: 안면인식 기록 시간
- **현재 위치**: GPS 기반 현장 내/외 표시
- **예상 퇴근**: 8시간 기준 예상 퇴근 시간

### 9.2 전자계약 관리 (WORK-02)
#### 9.2.1 기능 개요
근로계약서 및 각종 서약서에 전자서명을 수행합니다.

#### 9.2.2 상세 기능
**[WORK-02-01] 계약서 목록**
- **경로**: `/worker/contracts`
- **계약 상태**:
  - 서명 대기 (빨간 배지)
  - 서명 완료 (초록 배지)
  - 만료 예정 (노란 배지)
- **계약 종류**: 근로계약서, 안전교육서약서, 개인정보동의서

### 9.3 개인정보 관리 (WORK-03)
#### 9.3.1 기능 개요
개인 프로필과 안면인식 정보를 관리합니다.

#### 9.3.2 상세 기능
**[WORK-03-01] 기본 정보 관리**
- **경로**: `/worker/profile`
- **개인 정보**:
  - 이름, 연락처 (수정 가능)
  - 주민번호 (마스킹 표시, 수정 불가)
  - 주소 (도로명 주소 API 연동)
- **계좌 정보**:
  - 은행명, 계좌번호
  - 예금주명 (자동 검증)
  - 급여 수령 계좌 설정

---

## 10. 핵심 비즈니스 프로세스

### 10.1 안면인식 데이터 파이프라인
#### 10.1.1 프로세스 개요
노무자의 안면 데이터를 수집하여 현장 안면인식기에 동기화하는 전체 프로세스입니다.

#### 10.1.2 상세 프로세스
**[FACE-01] 안면 데이터 등록**
1. **노무자 사진 촬영**
   - 모바일 앱에서 전면 카메라 사용
   - 얼굴 가이드라인 및 품질 검증
   - 여러 각도 사진 촬영 (정면, 좌측, 우측)

2. **데이터 전처리**
   - 이미지 품질 검증 (해상도, 선명도)
   - 얼굴 영역 추출 및 정규화
   - S3 저장 및 메타데이터 DB 기록

3. **FaceNet 임베딩 생성**
   - FaceNet 서버로 이미지 전송
   - 512차원 벡터 임베딩 생성
   - 임베딩 데이터 DB 저장

**[FACE-02] 일일 동기화 배치**
- **실행 시간**: 매일 00:00 (자정)
- **처리 로직**:
  ```
  1. 금일 작업 배정 승인된 노무자 조회
  2. 해당 노무자의 Face Embedding 데이터 추출
  3. 현장별 안면인식기 활성 리스트 생성
  4. Edge Device 또는 Cloud API로 데이터 전송
  5. 동기화 완료 상태 업데이트
  ```

### 10.2 작업 배정 및 승인 프로세스
#### 10.2.1 프로세스 개요
현장 관리자의 작업 요청부터 팀장 수락, 최종 승인까지의 전체 워크플로우입니다.

#### 10.2.2 상세 프로세스
**[WORK-ASSIGN-01] 작업 요청 생성**
1. **현장 관리자 요청**
   - 작업일, 공종, 위치, 필요 인원 입력
   - 적합한 팀 목록 자동 추천
   - 팀장에게 Push 알림 발송

2. **팀장 응답 대기**
   - 요청 상태: "발송됨" → "확인됨"
   - 응답 기한: 2시간 (설정 가능)
   - 미응답 시 다른 팀에게 자동 재요청

### 10.3 전자계약 프로세스
#### 10.3.1 프로세스 개요
근로계약서 자동 생성부터 전자서명, PDF 생성까지의 전체 프로세스입니다.

#### 10.3.2 상세 프로세스
**[CONTRACT-01] 계약서 자동 생성**
1. **트리거 조건**
   - 신규 노무자 현장 배정 시
   - 기존 계약 만료 30일 전
   - 근무 조건 변경 시

2. **템플릿 바인딩**
   ```
   - 회사 정보: 상호, 사업자번호, 대표자명
   - 현장 정보: 현장명, 주소, 공사기간
   - 노무자 정보: 성명, 주민번호, 연락처
   - 근무 조건: 공종, 일당, 근무시간
   - 계약 기간: 시작일, 종료일
   ```

---

## 11. 외부 시스템 연동 명세

### 11.1 FaceNet 안면인식 시스템
#### 11.1.1 연동 개요
FaceNet 기반 안면인식 서버와의 API 연동을 통해 얼굴 임베딩 생성 및 매칭을 수행합니다.

#### 11.1.2 API 명세
**[FACE-API-01] 얼굴 임베딩 생성**
```http
POST /api/v1/face/embedding
Content-Type: multipart/form-data

Parameters:
- image: 얼굴 이미지 파일 (JPG, PNG)
- quality: 품질 검증 여부 (true/false)

Response:
{
  "success": true,
  "embedding": [0.123, -0.456, ...], // 512차원 벡터
  "confidence": 0.95,
  "face_detected": true,
  "quality_score": 0.87
}
```

### 11.2 기상청 날씨 API
#### 11.2.1 연동 개요
공사일보 작성 시 현장 위치 기반 날씨 정보를 자동으로 수집합니다.

### 11.3 PG사 결제 시스템
#### 11.3.1 연동 개요
구독 결제 및 자동 결제를 위한 PG사 API 연동입니다.

### 11.4 홈택스 세금계산서 API
#### 11.4.1 연동 개요
매월 자동으로 세금계산서를 발행하고 국세청에 전송합니다.

---

## 12. 데이터 모델 및 API 설계

### 12.1 핵심 엔티티 모델
#### 12.1.1 사용자 및 권한 관련

**[Entity] User (사용자)**
```java
@Entity
@Table(name = "users")
public class User extends BaseTenantEntity {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(nullable = false, unique = true)
    private String email;
    
    @Column(nullable = false)
    private String name;
    
    @Column(name = "phone_number")
    private String phoneNumber;
    
    @Enumerated(EnumType.STRING)
    private AuthProvider provider; // LOCAL, KAKAO, NAVER
    
    @ElementCollection(fetch = FetchType.EAGER)
    @Enumerated(EnumType.STRING)
    private Set<Role> roles = new HashSet<>();
    
    @Column(name = "is_active")
    private Boolean isActive = true;
}
```

**[Entity] Tenant (테넌트/회사)**
```java
@Entity
@Table(name = "tenants")
public class Tenant extends BaseEntity {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(name = "business_number", nullable = false, unique = true)
    private String businessNumber;
    
    @Column(name = "company_name", nullable = false)
    private String companyName;
    
    @Enumerated(EnumType.STRING)
    private TenantStatus status; // TRIAL, ACTIVE, SUSPENDED, TERMINATED
    
    @Column(name = "subscription_plan")
    private String subscriptionPlan;
    
    @Column(name = "max_sites")
    private Integer maxSites;
    
    @Column(name = "max_users")
    private Integer maxUsers;
}
```

### 12.2 REST API 설계 원칙
#### 12.2.1 URL 구조
```
/api/v1/{domain}/{resource}[/{id}][/{sub-resource}]

예시:
- GET /api/v1/sites - 현장 목록 조회
- GET /api/v1/sites/123 - 특정 현장 조회
- POST /api/v1/attendance/logs - 출역 기록 생성
```

#### 12.2.2 응답 형식 표준화
**[성공 응답]**
```json
{
  "success": true,
  "data": {
    // 실제 데이터
  },
  "message": "요청이 성공적으로 처리되었습니다.",
  "timestamp": "2025-12-31T10:30:00Z"
}
```

---

## 13. 보안 및 성능 요구사항

### 13.1 보안 요구사항
#### 13.1.1 인증 및 인가
- **JWT 토큰**: Access Token (15분), Refresh Token (7일)
- **토큰 저장**: HttpOnly Cookie 또는 Secure Storage
- **권한 검증**: 모든 API 요청에 대한 역할 기반 권한 확인
- **세션 관리**: 동시 로그인 제한 (최대 3개 디바이스)

#### 13.1.2 데이터 보안
- **개인정보 암호화**: AES-256 암호화 (주민번호, 계좌번호)
- **데이터 마스킹**: 화면 표시 시 민감정보 마스킹
- **전송 암호화**: HTTPS 강제, TLS 1.3 이상
- **데이터베이스**: 컬럼 레벨 암호화, 접근 로그 기록

### 13.2 성능 요구사항
#### 13.2.1 응답 시간
- **API 응답**: 평균 200ms 이하, 95% 1초 이하
- **페이지 로딩**: 초기 로딩 3초 이하
- **안면인식**: 1초 이내 인식 완료
- **파일 업로드**: 10MB 파일 30초 이내

#### 13.2.2 동시 사용자
- **동시 접속**: 1,000명 이상
- **피크 시간**: 오전 8시, 오후 6시 (출퇴근 시간)
- **데이터베이스**: 초당 1,000 TPS 처리
- **파일 저장소**: 동시 100개 파일 업로드

---

## 14. 테스트 시나리오 및 검증 기준

### 14.1 단위 테스트 (Unit Test)
#### 14.1.1 백엔드 테스트
```java
// 예시: 출역 시간 계산 테스트
@Test
void calculateWorkingHours_정상케이스() {
    // Given
    LocalDateTime checkIn = LocalDateTime.of(2025, 12, 31, 8, 0);
    LocalDateTime checkOut = LocalDateTime.of(2025, 12, 31, 18, 0);
    
    // When
    WorkingHours result = attendanceService.calculateWorkingHours(checkIn, checkOut);
    
    // Then
    assertThat(result.getTotalHours()).isEqualTo(BigDecimal.valueOf(10.0));
    assertThat(result.getRegularHours()).isEqualTo(BigDecimal.valueOf(8.0));
    assertThat(result.getOvertimeHours()).isEqualTo(BigDecimal.valueOf(2.0));
}
```

### 14.2 통합 테스트 (Integration Test)
#### 14.2.1 API 통합 테스트
```java
@SpringBootTest
@AutoConfigureTestDatabase
class SiteControllerIntegrationTest {
    
    @Test
    @WithMockUser(roles = "HQ")
    void createSite_성공() throws Exception {
        // Given
        CreateSiteRequest request = CreateSiteRequest.builder()
            .name("테스트 현장")
            .projectName("테스트 프로젝트")
            .startDate(LocalDate.now())
            .endDate(LocalDate.now().plusMonths(6))
            .build();
        
        // When & Then
        mockMvc.perform(post("/api/v1/sites")
                .contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(request)))
            .andExpect(status().isCreated())
            .andExpect(jsonPath("$.success").value(true))
            .andExpected(jsonPath("$.data.name").value("테스트 현장"));
    }
}
```

---

## 15. 배포 및 운영 가이드

### 15.1 개발 환경 설정
#### 15.1.1 로컬 개발 환경
```bash
# 1. 저장소 클론
git clone https://github.com/company/smartcon-lite.git
cd smartcon-lite

# 2. 백엔드 설정
cd backend
cp application-local.yml.example application-local.yml

# 3. 데이터베이스 실행 (Docker)
docker-compose up -d mariadb redis

# 4. 백엔드 실행
mvn spring-boot:run -Dspring.profiles.active=local

# 5. 프론트엔드 설정
cd ../frontend
npm install
cp .env.local.example .env.local

# 6. 프론트엔드 실행
npm run dev
```

### 15.2 프로덕션 배포
#### 15.2.1 CI/CD 파이프라인 (GitHub Actions)
```yaml
# .github/workflows/deploy.yml
name: Deploy to Production

on:
  push:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'
      
      - name: Run backend tests
        run: |
          cd backend
          mvn test
```

---

## 16. 결론 및 다음 단계

### 16.1 문서 요약
본 상세기능명세서는 SmartCON Lite SaaS 플랫폼의 전체 기능을 체계적으로 정의했습니다:

- **5단계 사용자 역할**별 상세 기능 명세
- **멀티테넌트 아키텍처** 기반 시스템 설계
- **안면인식, 전자계약, 정산** 등 핵심 비즈니스 프로세스
- **REST API 설계** 및 데이터 모델 정의
- **보안, 성능, 테스트** 요구사항
- **배포 및 운영** 가이드

### 16.2 개발 우선순위
실행계획에 따른 개발 우선순위는 다음과 같습니다:

**Phase 1 (1-2개월): 핵심 인프라**
- 멀티테넌트 아키텍처 구현
- 인증/인가 시스템 구축
- 기본 사용자 관리 기능

**Phase 2 (3-4개월): 기본 기능**
- 현장 및 팀 관리
- 작업 배정 시스템
- 기본 출역 관리

**Phase 3 (5-6개월): 고급 기능**
- 안면인식 연동
- 전자계약 시스템
- 공사일보 자동화

**Phase 4 (7-8개월): 비즈니스 기능**
- 정산 및 급여 계산
- 구독 결제 시스템
- 세금계산서 자동 발행

### 16.3 성공 지표 (KPI)
- **기술적 지표**: 응답시간 < 200ms, 가동률 > 99.9%
- **비즈니스 지표**: 월간 활성 사용자 1,000명, 고객 만족도 4.5/5.0
- **운영 지표**: 자동화율 90%, 장애 복구 시간 < 1시간

---

**문서 끝**

*본 문서는 SmartCON Lite 플랫폼 개발의 기준이 되는 상세 기능명세서입니다. 개발 과정에서 변경사항이 발생할 경우 본 문서를 업데이트하여 최신 상태를 유지해야 합니다.*