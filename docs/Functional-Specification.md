# SmartCON Lite 기능 명세서 (Functional Specification)

**문서 버전:** 2.1  
**작성일:** 2025년 12월 17일  
**최종 수정일:** 2025년 12월 18일  
**작성자:** 경영기획실 이대영 이사  
**기반 문서:** `docs/smartcon_functional_spec_V2.md`, `docs/PRD.md`

---

## 1. 개요
본 문서는 SmartCON Lite 플랫폼의 상세 기능을 정의합니다. 사용자의 역할(Role)에 따라 접근 가능한 기능이 구분되며, 웹(PC)과 모바일(App) 환경을 모두 지원합니다.

---

## 2. 권한 및 인증 (Auth & Roles)

### 2.1. 역할 정의
| Role Code | Role Name | Description | Platform |
| :--- | :--- | :--- | :--- |
| **ROLE_SUPER** | 슈퍼 어드민 | SaaS 플랫폼 전체 운영 및 결제/정산 관리 | Web |
| **ROLE_HQ** | 본사 관리자 | Tenant(회사) 관리, 현장 개설, 전사 통계 | Web |
| **ROLE_SITE** | 현장 관리자 | 현장 운영, 작업 지시, 출역 마감 | Web/App |
| **ROLE_TEAM** | 노무 팀장 | 팀원 관리, 작업 수락, 일보 제출 | App |
| **ROLE_WORKER** | 노무자 | 출역 조회, 전자계약 서명 | App |

### 2.2. 인증 기능

#### 2.2.1. 인증 플로우
1. **인트로 페이지** (`/`): 서비스 소개 및 로그인 진입점
2. **로그인 방식 선택** (`/login`): 본사 관리자 로그인 vs 소셜 로그인 선택
3. **본사 관리자 로그인** (`/login/hq`): 사업자번호(ID) + 비밀번호
4. **소셜 로그인** (`/login/social`): Kakao, Naver OAuth2
5. **역할 선택** (`/role-select`): 다중 역할 보유 시 역할 선택
6. **대시보드**: 선택된 역할에 따른 대시보드로 이동

#### 2.2.2. 인증 방식
- **본사 관리자**: ID(사업자번호) + 비밀번호
- **현장 관리자/팀장/노무자**: 소셜 로그인 (Kakao, Naver) 기반 SSO
- **다중 프로필**: 1개의 계정으로 여러 현장/역할 수행 가능 (로그인 후 선택)
- **자동 로그아웃**: 보안을 위해 30분 미활동 시 세션 만료

---

## 3. 상세 기능 목록

### 3.1. 슈퍼 어드민 (SaaS Admin)
- **[ADM-01] 테넌트 관리**: 가입 회사 목록 조회, 서비스 중지/해지, 비밀번호 초기화 리셋.
- **[ADM-02] 결제 모니터링**: 월별 구독 결제 현황, 실패 건 재청구(Retry), 결제 수단 관리.
- **[ADM-03] 세금계산서 발행**: 매월 1일 전월 사용분에 대한 세금계산서 일괄 발행 (홈택스 연동).

### 3.2. 본사 관리자 (HQ)
- **[HQ-01] 회사 정보**: 사업자 정보, 로고, 직인 이미지 등록.
- **[HQ-02] 현장 개설**: 신규 현장 등록 (현장명, 위치, 기간, 안면인식기 시리얼).
- **[HQ-03] 표준 단가 관리**: 전사 표준 공종/직종 및 기준 노무 단가 설정.
- **[HQ-04] 전사 대시보드**: 전체 현장의 공정률, 안전 사고, 금일 출역 인원 실시간 모니터링.

### 3.3. 현장 관리자 (Site)
- **[SITE-01] 팀 관리**: 작업 팀 초대(SMS), 팀원 명단 승인/반려.
- **[SITE-02] 작업 지시 (Assignment)**: 특정 날짜/공종/위치에 대해 팀에게 작업 요청.
- **[SITE-03] 공사일보 마감**: 
    - 날씨/기온 자동 입력.
    - 팀별 제출 일보 취합 및 수정.
    - 최종 승인 및 PDF 생성/저장.
- **[SITE-04] 출역 마감**: 안면인식 로그 + 팀장 보고 대조 후 공수 확정.
- **[SITE-05] 근로계약 관리**: 미체결 인원 조회 및 일괄 서명 요청 발송.

### 3.4. 노무 팀장 (Team)
- **[TEAM-01] 작업 수락**: 현장 관리자의 작업 요청 확인 후 수락/거부.
- **[TEAM-02] 투입 인원 보고**: 수락된 작업에 투입할 팀원 명단 및 공수 입력.
- **[TEAM-03] 간편 일보**: 작업 사진 촬영 및 특이사항(메모) 입력 후 제출.

### 3.5. 노무자 (Worker)
- **[WORK-01] 출퇴근 체크**: GPS/WiFi 기반 모바일 출근/퇴근 체크 (보조 수단).
- **[WORK-02] 출역 이력**: 나의 월간 출역 캘린더, 공수 합계, 예상 수령액 조회.
- **[WORK-03] 전자 서명**: 근로계약서, 안전교육서약서 등 전자 서명 (Canvas).

---

## 4. 핵심 데이터 처리 로직

### 4.1. 안면인식 동기화 (Face Sync)
- **Trigger**: 매일 00:00 or 현장 관리자 수동 요청.
- **Process**:
  1. `WorkAssignment` 테이블에서 금일 승인된(`APPROVED`) 작업 조회.
  2. 해당 팀의 팀원(`Worker`) 목록 추출.
  3. `FaceEmbedding` 테이블에서 해당 인원의 벡터 데이터 로드.
  4. 현장 Edge Device 또는 FaceNet Server의 'Today Active List'에 등록.

### 4.2. 정산 및 노무비 (Settlement)
- **로직**: `Sum(개인별 공수 * (현장별 약정 단가 + 팀장 수당))`
- **주기**: 현장 설정에 따름 (월간, 주간, 일일).
- **출력물**: 노무비 지급 명세서 (Excel/PDF).

---

**문서 꿑**
